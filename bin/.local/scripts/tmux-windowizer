#!/usr/bin/env bash

# Check arguments
if [ "$#" -lt 1 ]; then
    echo "Usage: $0 <branch-name> [command ...]"
    exit 1
fi

branch_name=$(basename -- "$1")
session_name=$(tmux display-message -p "#S")
clean_name=$(echo "$branch_name" | tr './' '__')
target="$session_name:$clean_name"

if ! tmux has-session -t "$target" 2>/dev/null; then
    tmux neww -dn "$clean_name"
fi

shift
if [ "$#" -gt 0 ]; then
    tmux send-keys -t "$target" "$*" ENTER
fi

exit 0
